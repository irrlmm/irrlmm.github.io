---
import { getImage } from "astro:assets";

import ProjectItem from "./ProjectItem";

interface Props {
  title: string;
  timeline?: string;
  lines: string[];
  imgs: { src: ImageMetadata; chip?: string; logo?: ImageMetadata }[];
  link?: UI.Link;
}

const { title, timeline, lines, link, imgs } = Astro.props;

// Preload and optimize all images at build time
const pictureData = await Promise.all(
  imgs.map(({ src, ...rest }) =>
    getImage({
      src,
      format: "webp",
      quality: 99,
      width: 2566,
    }).then((optimizedImage) => ({
      imgSrc: optimizedImage.src,
      ...rest,
    }))
  )
);

// Extract just the optimized URL string from each image object
const optimizedSrcs = pictureData.map((data) => ({
  imgSrc: data.imgSrc,
  chip: data.chip,
}));
---

<ProjectItem
  client:load
  title={title}
  timeline={timeline}
  lines={lines}
  link={link}
  content={optimizedSrcs}
/>
